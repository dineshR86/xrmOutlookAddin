!function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=126)}({126:function(e,t,s){"use strict";var o={sitecollection:"",list:"",statusfilter:"",clientfilter:"",clientfield:"",stakeholderfilter:"",stakeholderfield:"",filterfield:""},i={Subject:"",To:"",From:"",ConversationId:"",Received:"",Message:"",ConversationTopic:"",itemid:"",listid:"",sitecollectionUrl:"",listname:""},l="https://xrmaddin.azurewebsites.net/api/",n="yXSBa1SLBbAvC7p7HIsLZ/R5PwZNwEOapWimJHma8eui5jBtHyL26w==";function a(e){return e.displayName+":"+e.emailAddress+";"}Office.initialize=function(e){$(document).ready(function(){$(".loader").css("display","block"),$.ajax({url:l+"GetXRMAddInConfiguration?code="+n,method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){$.each(e.SiteCollectionUrls.split(";"),function(e,t){$("#sitecollections").append('<option value="'+t+'">'+t+"</option>")}),$.each(e.Lists.split(";"),function(e,t){$("#listsdd").append('<option value="'+t+'">'+t+"</option>")}),$.each(e.ProjectStatusFilter.split(";"),function(e,t){$("#projectstatus").append('<option value="'+t+'">'+t+"</option>")}),$(".loader").css("display","none")},error:function(e){console.log(e),$("#afailure").text(e.statusText+":"+e.responseJSON.summary).css("display","block"),$(".loader").css("display","none")}}),$("#sitecollections").on("change",function(e){var t=$(this).find("option:selected");"-select-"==t.text()?$("#lists").css("display","none"):($("#lists").css("display","block"),o.sitecollection=t.val(),i.sitecollectionUrl=t.val(),$(".loader").css("display","block"),$.ajax({url:l+"GetContractFilters?code="+n+"&sc="+$("#sitecollections").find("option:selected").val(),method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){$.each(e.Clients,function(e,t){var s=t.split(",");$("#relatedClient").append('<option value="'+s[1]+'">'+s[0]+"</option>")}),$.each(e.Stakeholders,function(e,t){var s=t.split(",");$("#relatedStakeholder").append('<option value="'+s[1]+'">'+s[0]+"</option>")}),$.each(e.Status,function(e,t){var s=t.split(",");$("#casestatus").append('<option value="'+s[1]+'">'+s[0]+"</option>")}),$(".loader").css("display","none")},error:function(e){console.log(e),$("#afailure").text(e.statusText+":"+e.responseText).css("display","block"),$(".loader").css("display","none")}})),$(this).attr("disabled","disabled")}),$("#listsdd").on("change",function(e){var t=$(this).find("option:selected");"-select-"==t.text()?($("#casefilter").css("display","none"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","none")):t.val().indexOf("Cases")>-1?($("#casefilter").css("display","block"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","none")):t.val().indexOf("Projects")>-1?($("#casefilter").css("display","none"),$("#projectfilter").css("display","block"),$("#contractfilter").css("display","none")):t.val().indexOf("Contracts")>-1&&($("#casefilter").css("display","none"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","block")),o.list=t.val(),i.listname=t.val(),i.listid="Lists/"+t.val(),$("#listsdd").attr("disabled","disabled")}),$("#casestatus,#projectstatus,#relatedClient,#relatedStakeholder").on("change",function(e){var t=$(this).find("option:selected"),s=t.prevObject;"casestatus"==s[0].id?(o.statusfilter=t.val(),o.filterfield="StatusLookupId"):"projectstatus"==s[0].id?(o.statusfilter=t.val(),o.filterfield="Status"):"relatedClient"==s[0].id?(o.clientfilter=t.val(),o.clientfield="ClientContractPartyLookupId"):"relatedStakeholder"==s[0].id&&(o.stakeholderfilter=t.val(),o.stakeholderfield="StakeholderContractPartyLookupId"),$("#btnFetch").css("display","block")}),$("#btnFetch").click(function(e){$("#xrmitems").css("display","block"),function(e){var t="";t=e.clientfield.length>0&&e.stakeholderfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.clientfield+"&val="+e.clientfilter+"&ff1="+e.stakeholderfield+"&val1="+e.stakeholderfilter:e.clientfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.clientfield+"&val="+e.clientfilter:e.stakeholderfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.stakeholderfield+"&val="+e.stakeholderfilter:"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.filterfield+"&val="+e.statusfilter,console.log(t),function(e){$(".loader").css("display","block"),$("#ddsaveemail").css("display","block"),$("#ddsaveattachments").css("display","block"),$.ajax({url:l+"GetListItems?code="+n+"&"+e,method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){console.log(e),$.each(e,function(e,t){$("#xrmitemsDD").append('<option value="'+t.ID+'">'+t.Title+"</option>")}),$("#btnFetch").css("display","none"),$(".loader").css("display","none")},error:function(e){console.log(e),$("#afailure").text(e.statusText+":"+e.responseText).css("display","block"),$(".loader").css("display","none")}})}(t)}(o)}),$("#xrmitemsDD").on("change",function(e){$("#btnSave").css("display","block"),i.itemid=$(this).find("option:selected").val()}),$("#btnSave").click(function(e){$("#saveemail").is(":checked")||$("#saveattachments").is(":checked")?($("#saveemail").is(":checked")&&function(e){$(".loader").css("display","block"),i.Subject=e.subject,i.ConversationTopic=e.subject,i.From=a(e.from),i.Received=new Date(e.dateTimeCreated).toISOString(),i.ConversationId=e.conversationId,i.sitecollectionUrl=$("#sitecollections").find("option:selected").val(),i.listname="Outlook Emails",i.To=function(e){if(e&&e.length>0){for(var t="",s=0;s<e.length;s++)s>0&&(t+="<br/>"),t+=a(e[s]);return t}return"None"}(e.to),e.body.getAsync("text",function(e){"succeeded"===e.status&&(i.Message=e.value,$.ajax({url:l+"SaveItem?code="+n,method:"POST",data:JSON.stringify(i),headers:{Accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose"},success:function(e){console.log(e);var t=$("#asuccess").text();$("#asuccess").text(t+"<br/>"+e.summary).css("display","block"),Office.context.ui.closeContainer(),$("#savesection").css("display","none")},error:function(e){console.log(e),$("#afailure").text(e.statusText+":"+e.responseJSON.summary).css("display","block")}}))}),$(".loader").css("display","none")}(Office.context.mailbox.item),$("#saveattachments").is(":checked")&&function(e){$.ajax({url:l+"SaveAttachments?code="+n,method:"POST",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose"},success:function(e){console.log(e);var t=$("#asuccess").text();$("#asuccess").text(t+"<br/>"+e.summary).css("display","block")},error:function(e){console.log(e),$("#afailure").text(e.statusText+":"+e.responseJSON.summary).css("display","block")}})}({UserId:Office.context.mailbox.userProfile.emailAddress,MessageId:Office.context.mailbox.convertToRestId(Office.context.mailbox.item.itemId,Office.MailboxEnums.RestVersion.v2_0),ItemTitle:$("#xrmitemsDD").find("option:selected").text(),ItemID:$("#xrmitemsDD").find("option:selected").val(),ListName:$("#listsdd").find("option:selected").val(),sitecollectionUrl:$("#sitecollections").find("option:selected").val()})):console.log("Saveemail must be checked")})})}}});