!function(e){var t={};function o(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(i,s,function(t){return e[t]}.bind(null,s));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=126)}({126:function(e,t,o){"use strict";var i={sitecollection:"",list:"",statusfilter:"",clientfilter:"",clientfield:"",stakeholderfilter:"",stakeholderfield:"",filterfield:""},s={Subject:"",To:"",From:"",ConversationId:"",Received:"",Message:"",ConversationTopic:"",itemid:"",listid:"",sitecollectionUrl:"",listname:""},l="https://xrmoutlookaddin.azurewebsites.net/api/",n="DL8XWGougr5eizgk/6qXzPy7O3sI4j31hpIVOk7a5SujVSYwLx/QZA==";function c(e){return e.displayName+":"+e.emailAddress+";"}$(document).ready(function(){$(".loader").css("display","block"),console.log("Fetching Config list data"),$.ajax({url:l+"GetXRMAddInConfiguration?code="+n,method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){$.each(e.SiteCollectionUrls.split(";"),function(e,t){$("#sitecollections").append('<option value="'+t+'">'+t+"</option>")}),$.each(e.Lists.split(";"),function(e,t){$("#listsdd").append('<option value="'+t+'">'+t+"</option>")}),$.each(e.ProjectStatusFilter.split(";"),function(e,t){$("#projectstatus").append('<option value="'+t+'">'+t+"</option>")}),$(".loader").css("display","none"),$("#asuccess").text(e).css("display","block")},error:function(e){console.log(e),$("#afailure").text(e.statusText).css("display","block")}}),$(".loader").css("display","block"),console.log("Fetching Config list data"),$.ajax({url:l+"GetContractFilters?code="+n,method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){$.each(e.Clients,function(e,t){var o=t.split(",");$("#relatedClient").append('<option value="'+o[1]+'">'+o[0]+"</option>")}),$.each(e.Stakeholders,function(e,t){var o=t.split(",");$("#relatedStakeholder").append('<option value="'+o[1]+'">'+o[0]+"</option>")}),$.each(e.Status,function(e,t){var o=t.split(",");$("#casestatus").append('<option value="'+o[1]+'">'+o[0]+"</option>")}),$(".loader").css("display","none")},error:function(e){console.log(e)}}),$("#sitecollections").on("change",function(e){var t=$(this).find("option:selected");"-select-"==t.text()?$("#lists").css("display","none"):($("#lists").css("display","block"),i.sitecollection=t.val(),s.sitecollectionUrl=t.val()),$(this).attr("disabled","disabled")}),$("#listsdd").on("change",function(e){var t=$(this).find("option:selected");"-select-"==t.text()?($("#casefilter").css("display","none"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","none")):t.val().indexOf("Cases")>-1?($("#casefilter").css("display","block"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","none")):t.val().indexOf("Projects")>-1?($("#casefilter").css("display","none"),$("#projectfilter").css("display","block"),$("#contractfilter").css("display","none")):t.val().indexOf("Contracts")>-1&&($("#casefilter").css("display","none"),$("#projectfilter").css("display","none"),$("#contractfilter").css("display","block")),i.list=t.val(),s.listname=t.val(),s.listid="Lists/"+t.val(),$("#listsdd").attr("disabled","disabled")}),$("#casestatus,#projectstatus,#relatedClient,#relatedStakeholder").on("change",function(e){var t=$(this).find("option:selected"),o=t.prevObject;"casestatus"==o[0].id?(i.statusfilter=t.val(),i.filterfield="StatusLookupId"):"projectstatus"==o[0].id?(i.statusfilter=t.val(),i.filterfield="Status"):"relatedClient"==o[0].id?(i.clientfilter=t.val(),i.clientfield="Client_x0020_Contract_x0020_PartLookupId"):"relatedStakeholder"==o[0].id&&(i.stakeholderfilter=t.val(),i.stakeholderfield="Stakeholder_x0020_Contract_x0020LookupId"),$("#btnFetch").css("display","block")}),$("#btnFetch").click(function(e){$("#xrmitems").css("display","block"),function(e){var t="";t=e.clientfield.length>0&&e.stakeholderfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.clientfield+"&val="+e.clientfilter+"&ff1="+e.stakeholderfield+"&val1="+e.stakeholderfilter:e.clientfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.clientfield+"&val="+e.clientfilter:e.stakeholderfield.length>0?"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.stakeholderfield+"&val="+e.stakeholderfilter:"sc="+e.sitecollection+"&list="+e.list+"&ff="+e.filterfield+"&val="+e.statusfilter,console.log(t),function(e){$(".loader").css("display","block"),console.log("Fetching list item data"),$("#ddsaveemail").css("display","block"),$("#ddsaveattachments").css("display","block"),$.ajax({url:l+"GetListItems?code="+n+"&"+e,method:"Get",headers:{Accept:"application/json;odata=verbose"},success:function(e){console.log(e),$.each(e,function(e,t){$("#xrmitemsDD").append('<option value="'+t.ID+'">'+t.Title+"</option>")}),$("#btnFetch").css("display","none"),$(".loader").css("display","none")},error:function(e){console.log(e)}})}(t)}(i)}),$("#xrmitemsDD").on("change",function(e){$("#btnSave").css("display","block"),s.itemid=$(this).find("option:selected").val()}),$("#btnSave").click(function(e){$("#saveemail").is(":checked")||$("#saveattachments").is(":checked")?($("#saveemail").is(":checked")&&function(e){$(".loader").css("display","block"),s.Subject=e.subject,s.ConversationTopic=e.subject,s.From=c(e.from),s.Received=new Date(e.dateTimeCreated).toISOString(),s.ConversationId=e.conversationId,s.sitecollectionUrl=$("#sitecollections").find("option:selected").val(),s.listname="Outlook Emails",s.To=function(e){if(e&&e.length>0){for(var t="",o=0;o<e.length;o++)o>0&&(t+="<br/>"),t+=c(e[o]);return t}return"None"}(e.to),e.body.getAsync("text",function(e){"succeeded"===e.status&&(s.Message=e.value,console.log(JSON.stringify(s)),$.ajax({url:l+"SaveItem?code="+n,method:"POST",data:JSON.stringify(s),headers:{Accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose"},success:function(e){console.log(e)},error:function(e){console.log(e)}}))}),console.log(s),$(".loader").css("display","none")}(Office.context.mailbox.item),$("#saveattachments").is(":checked")&&function(e){console.log(JSON.stringify(e)),$.ajax({url:l+"SaveAttachments?code="+n,method:"POST",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose"},success:function(e){console.log(e)},error:function(e){console.log(e)}})}({UserId:Office.context.mailbox.userProfile.emailAddress,MessageId:Office.context.mailbox.convertToRestId(Office.context.mailbox.item.itemId,Office.MailboxEnums.RestVersion.v2_0),ItemTitle:$("#xrmitemsDD").find("option:selected").text(),ItemID:$("#xrmitemsDD").find("option:selected").val(),ListName:$("#listsdd").find("option:selected").val(),sitecollectionUrl:$("#sitecollections").find("option:selected").val()})):console.log("Saveemail must be checked")})})}});